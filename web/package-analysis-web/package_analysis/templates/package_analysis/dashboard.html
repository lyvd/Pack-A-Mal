{% extends "package_analysis/layout.html" %}
{%block header %}

<style>
    /* General form styling */
    .form-upload {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        margin: 0 auto;
    }

    /* Label styling */
    .form-upload label {
        font-weight: bold;
        margin-bottom: 8px;
        color: #333;
    }

    /* Input field styling */
    .form-upload input[type="file"] {
        margin-bottom: 16px;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 100%;
        box-sizing: border-box;
    }

    /* Button styling */
    .form-upload button[type="submit"] {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .form-upload button[type="submit"]:hover {
        background-color: #0056b3;
    }

    /* Night mode styling */
    body.night .form-upload {
        background-color: #333;
        color: #f9f9f9;
    }

    body.night .form-upload label {
        color: #f9f9f9;
    }

    body.night .form-upload input[type="file"] {
        border: 1px solid #555;
        background-color: #444;
        color: #f9f9f9;
    }

    body.night .form-upload button[type="submit"] {
        background-color: #444;
        color: #f9f9f9;
    }

    body.night .form-upload button[type="submit"]:hover {
        background-color: #555;
    }

    /* Cyborg mode styling */
    body.cyborg .form-upload {
        background-color: #222;
        color: #00ff00;
    }

    body.cyborg .form-upload label {
        color: #00ff00;
    }

    body.cyborg .form-upload input[type="file"] {
        border: 1px solid #00ff00;
        background-color: #333;
        color: #00ff00;
    }

    body.cyborg .form-upload button[type="submit"] {
        background-color: #00ff00;
        color: #222;
    }

    body.cyborg .form-upload button[type="submit"]:hover {
        background-color: #00cc00;
    }
</style>




<script>
     
    // For displaying the number of commands, network connections, files, and system calls after scan completion
    document.addEventListener("DOMContentLoaded", function() {
        

        var report_data = {{ reports|safe }};

        // console.log(report_data);
        var numCommands = document.getElementById("num-commands");
        var numNetworkConnections = document.getElementById("num-network-connections");
        var numFiles = document.getElementById("num-files");
        var numSystemCalls = document.getElementById("num-system-calls");

        if (report_data) {
            var totalCommands = (report_data.install.num_commands || 0) + (report_data.execute.num_commands || 0);
            var totalNetworkConnections = (report_data.install.num_network_connections || 0) + (report_data.execute.num_network_connections || 0);
            var totalFiles = (report_data.install.num_files || 0) + (report_data.execute.num_files || 0);
            var totalSystemCalls = (report_data.install.num_system_calls || 0) + (report_data.execute.num_system_calls || 0);

            numCommands.innerHTML = `Install: ${report_data.install.num_commands || "N/A"}<br>Exec: ${report_data.execute.num_commands || "N/A"}<br>Total: ${totalCommands}`;
            numNetworkConnections.innerHTML = `Install: ${report_data.install.num_network_connections || "N/A"}<br>Exec: ${report_data.execute.num_network_connections || "N/A"}<br>Total: ${totalNetworkConnections}`;
            numFiles.innerHTML = `Install: ${report_data.install.num_files || "N/A"}<br>Execute: ${report_data.execute.num_files || "N/A"}<br>Total: ${totalFiles}`;
            numSystemCalls.innerHTML = `Install: ${report_data.install.num_system_calls || "N/A"}<br>Exec: ${report_data.execute.num_system_calls || "N/A"}<br>Total: ${totalSystemCalls}`;


            // information package_name, package_version, ecosystem display for id reports
            var reports = document.getElementById("reports");
            reports.innerHTML = `Package Name: <b>${report_data.packages.package_name || "N/A"}</b> 
                                 Package Version: <b>${report_data.packages.package_version || "N/A"}</b> 
                                 Ecosystem: <b>${report_data.packages.ecosystem || "N/A"}</b> 
                                 Time: <b>${(report_data.time || 0).toFixed(2)}</b> (seconds)`;
        }
    });


</script>

{% endblock %}

{% block body %}
        <div id="cuckoo-dashboard" class="hidden"> </div>
        <div class="flex-grid__horizontal--grow dashboard">
            <div class="flex-grid__column dashboard__left">
                <h2 class="dashboard__col-title">Malcontent</h2>
                <div class="dashboard-module" data-dashboard-module="installation"> 
                    <header class="dashboard-module__header">
                        <h4>package-analysis-apk Installation</h4>
                    </header>
                    <section class="dashboard-module__body">
                        <table class="simple">
                            <tbody>
                                <tr>
                                    <td>Version</td>
                                    <td>1.0.0</td>
                                </tr>
                            </tbody>
                        </table>
                    </section>
                </div>
                <div class="dashboard-module">
                    <header class="dashboard-module__header">
                        <h4>Usage statistics</h4>
                    </header>
                    <section class="dashboard-module__body">
                        <table class="simple">
                            <tbody data-populate="statistics">
                                <tr>
                                    <td>Reported</td>
                                    <td>5868258</td>
                                </tr>
                                <tr>
                                    <td>Completed</td>
                                    <td>0</td>
                                </tr>
                                <tr>
                                    <td>Total</td>
                                    <td>5909340</td>
                                </tr>
                                <tr>
                                    <td>Running</td>
                                    <td>0</td>
                                </tr>
                                <tr>
                                    <td>Pending</td>
                                    <td>0</td>
                                </tr>
                            </tbody>
                        </table>
                    </section>
                </div>


            </div>

            <div class="flex-grid__column dashboard__right">
                <h2 class="dashboard__col-title">package-analysis-apk</h2>
                <div class="dashboard-module__lg" data-dashboard-module="upload">
                    <div class="dashboard-module__body omni-uploader">
                        <div class="dashboard-module__body--left">
                            
                            <form class="form-upload" action="{% url 'upload' %}" method="post" enctype="multipart/form-data">
                                {% csrf_token %}
                                <label for="file">Choose file to upload:</label>
                                <input type="file" id="file" name="file" required>
                                <br><br>
                                <button type="submit">Upload</button>
                            </form>

                            <div class="allowed-file-types">
                                <br>
                                <h4>Supported file types:</h4>

                                <ul>
                                    <li>APK <i class="fa fa-file-archive"></i></li>
                                </ul>
                            </div>
                        </div>
                        <div class="dashboard-module__body--right">
                            <div id="submit-with-link" >
                                <form method="post" action="{% url 'dashboard' %}">
                                    {% csrf_token %}
                                    <!-- {{ form.as_p }}     -->
                                      {{ form.package_name.label_tag }}
                                      {{ form.package_name }}     
                                      <br>                  
                                    <div class="suggestions" id="suggestions"></div>
                                    {{ form.package_version.label_tag }}
                                    {{ form.package_version }}
                                    <br>
                                    {{ form.ecosystem.label_tag }}
                                    {{ form.ecosystem }}
                                    <br>
                                    <div class="text-center">
                                    <button type="submit" class="btn btn-primary btn-lg">Submit</button>
                                    </div>
                                </form>
                            
                            </div>
                            
                        </div>

                    </div>
                    <div class="dashboard-module__footer">
                        <p class="align-left"><i class="fa fa-info-circle"></i> Click the 'Choose File' to select a file.</p>
                    </div>
                </div>

                <div class="dashboard-module" data-dashboard-module="system">
                    <header class="dashboard-module__header">
                        <h4 class="align-left clearfix">
                            <div id="reports">Reports</div>    
                            <div class="pull-right">
                                <span class="label label-free">Commands</span>
                                <span class="label label-used">Domains</span>
                                <span class="label label-total">Syscalls</span>
                            </div>
                        </h4>
                    </header>

                    <section class="dashboard-module__body free-disk-space">
                        <div class="dashboard-module__body--flex">
                            <h5>Number of Commands</h5>
                            <div class="free-disk-space__chart" id="ds-stat">
                                <canvas style="display: block; height: 135px; width: 135px;" width="168" height="168"></canvas>
                                <div class="free-disk-space__legend", id="num-commands">
                                        
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-module__body--flex">
                            <h5>Number of Network connections</h5>
                            <div class="free-disk-space__chart" id="ds-stat">
                                <canvas style="display: block; height: 135px; width: 135px;" width="168" height="168"></canvas>
                                <div class="free-disk-space__legend" id="num-network-connections">
                                    
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-module__body--flex">
                            <h5>Number of Files</h5>
                            <div class="free-disk-space__chart" id="ds-stat">
                                <canvas style="display: block; height: 135px; width: 135px;" width="168" height="168"></canvas>
                                <div class="free-disk-space__legend" id="num-files">
                                    
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-module__body--flex">
                            <h5>Number of System calls</h5>
                            <div class="free-disk-space__chart" id="ds-stat">
                                <canvas style="display: block; height: 135px; width: 135px;" width="168" height="168"></canvas>
                                <div class="free-disk-space__legend" id="num-system-calls">
                                    
                                </div>
                            </div>
                        </div>

                    </section>

                </div>

            </div>

        </div>

{% endblock %}


